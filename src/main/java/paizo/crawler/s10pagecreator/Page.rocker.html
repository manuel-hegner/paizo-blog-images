
@import java.util.List
@import org.apache.commons.lang3.tuple.Pair
@import paizo.crawler.common.model.BlogPost
@import paizo.crawler.common.model.BlogImage
@import paizo.crawler.s05imagedownloader.ImageDownloader
@import java.time.LocalDate

@args (String mode, Month month, List<MonthCount> monthCounts, LocalDate checkedUpTo)

<!DOCTYPE html>
<html lang="en">
	<head>
	    <meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	    <meta http-equiv="X-UA-Compatible" content="ie=edge">
	    <title>Paizo Blog Images @month.month()</title>
	    <style>
			body {
				font-family: arial;
			}
			
			.tag {
				background-color: lightgray;
				padding: .2rem .4rem;
				border-radius: .4rem;
			}
			
			.g2 {
				grid-template-columns: 1fr 1fr;
				display: grid;
				grid-gap: 1rem;
			}
			
			.w100 {
				width: 100%;
			}
			
			img {
				max-height: 30rem;
				max-width: 100%;
			}
			
			.raw-text {
				height: 30rem;
			}
			
			.not-uploaded {
				background-color: lightsalmon;
			}
			
			a {
				text-decoration: none;
			}
			
			a.small {
				font-size: 60%;
			}
		</style>
	</head>
	<body>
	<div>
		Modes: <select id="mode-select" onchange="location = this.value;" autocomplete="off">
			<option value="@month.month()-all.html" @if("all".equals(mode)){selected}>All</option>
			<option value="@month.month()-pf.html" @if("pf".equals(mode)){selected}>Pathfinder only</option>
			<option value="@month.month()-sf.html" @if("sf".equals(mode)){selected}>Starfinder only</option>
		</select>
	</div>
	<div>
		Months: <select id="month-select" onchange="location = this.value;" autocomplete="off">
			<option></option>
		@for(MonthCount mc : monthCounts) {
			@if(mc.count()>0) {
				<option value="@mc.month()-@(mode).html" @if(mc.month().equals(month.month())){selected}>@mc.month() (@mc.count())</option>
			}
		}
		</select>
		Manually Checked Months: <select id="month-checked-select" onchange="location = this.value;" autocomplete="off">
			<option></option>
		@for(MonthCount mc : monthCounts) {
			@if(mc.count()==0) {
				<option value="@mc.month()-@(mode).html" @if(mc.month().equals(month.month())){selected}>@mc.month()</option>
			}
		}
		</select>
	</div>
	<div>
	
	</div>
	<hr>
	@for(BlogPost post : month.posts()) {
	<div>
		<h3>
			@post.getDate().getYear()-@post.getDate().getMonthValue()-@post.getDate().getDayOfMonth()
			- 
			<a href="https://paizo.com/community/blog/@post.getId()">
			@post.getTitle()
			</a>
		</h3>
		@if(post.getTags() != null) {
		<div class="tags">
			@for(String tag : post.getTags()) {
				<span class="tag">@tag</span>
			}
		</div>
		}
		<br>
		@if(post.getImages() != null) {
		<div>
		@for(BlogImage img : post.getImages()) {
			<div class="w100 g2 @if(!img.getWikiMappings().hasMapping()){not-uploaded} @if(img.getWikiMappings().getPf()!=null){pf} @if(img.getWikiMappings().getSf()!=null){sf}">
				@with(String link = "https://github.com/manuel-hegner/paizo-blog-images/raw/main/blog_post_images/"+img.getName()) {
					<div>
						<a href="@link" download>
							<img src="@link">
						</a><br>
						@if(img.getWikiMappings().hasMapping()) {
							@if(img.getWikiMappings().getPf()!=null){
								Already uploaded to Pathfinderwiki as <a href="https://pathfinderwiki.com/wiki/File:@img.getWikiMappings().getPf().getName()">@img.getWikiMappings().getPf().getName()</a><br>
							}
							@if(img.getWikiMappings().getSf()!=null){
								Already uploaded to Starfinderwiki as <a href="https://starfinderwiki.com/wiki/File:@img.getWikiMappings().getSf().getName()">@img.getWikiMappings().getSf().getName()</a><br>
							}
						} else {
							@if(!post.getDate().toLocalDate().isAfter(checkedUpTo)) {
								Manually checked
							} else {
								Maybe no yet uploaded
							}
						}
					</div>
				}
				<textarea class="w100 raw-text">@ImageDownloader.wikitext(post, img)</textarea>
			</div>
		}
		</div>
		}
	</div>
	}
	</body>
</html>
